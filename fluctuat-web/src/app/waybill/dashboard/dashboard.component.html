<flu-hero-container class="content">

  <ng-container *ngIf="filteredWaybills$ | async as waybills; else loading">

    <h1 class="title">Mes lettres de voiture ({{ waybills.length }})</h1>


    <div style="margin-bottom: 1.5rem">
      <button class="button is-link" [routerLink]="'/lettre-de-voiture/new'">Nouvelle lettre de voiture</button>

      <div class="select" style="margin-left: 0.75rem">
        <select [(ngModel)]="statusFilter" (change)="refreshFilteredWaybills()">
          <option [value]="STATUS_OPTION.ALL">Toutes</option>
          <option [value]="STATUS_OPTION.IN_PROGRESS">En cours</option>
          <option [value]="STATUS_OPTION.END">Finies</option>
        </select>
      </div>

    </div>

    <div class="card" *ngFor="let waybill of waybills" style="margin-bottom: 0.75rem">
      <div class="card-content">

        <p class="is-size-4"><a [routerLink]="['/lettre-de-voiture', waybill.code, 'detail']">{{waybill.code}}</a></p>

        <div class="columns">
          <div class="column is-narrow">
            <span class="icon"><i class="fa fa-water"></i></span>
            {{waybill.order.sender.name || 'non renseigné'}}
            <span class="icon"><i class="fa fa-arrow-right"></i></span>
            {{waybill.order.receiver.name || 'non renseigné'}}
          </div>
          <div class="column is-narrow">
            <span class="icon"><i class="fa fa-ship"></i></span>
            {{waybill.order.ship.name || 'non renseigné'}}
          </div>
        </div>
        <div class="columns">
          <div class="column is-narrow">
            <span class="icon"><i class="far fa-calendar-alt"></i></span>
            {{waybill.loadInfo.endDate ? waybill.loadInfo.endDate : waybill.order.originInfo.expectedDate || 'non renseignée'}}
            <span class="icon"><i class="fa fa-arrow-right"></i></span>
            {{waybill.unloadInfo.endDate ? waybill.unloadInfo.endDate : waybill.order.destinationInfo.expectedDate || 'non renseignée'}}
          </div>
        </div>

        <p>{{getStatus(waybill)}}</p>

        <div class="buttons">
          <flu-waybill-options [waybill]="waybill"></flu-waybill-options>
        </div>

      </div>
    </div>

  </ng-container>
</flu-hero-container>

<ng-template #loading>
  <flu-loading></flu-loading>
</ng-template>

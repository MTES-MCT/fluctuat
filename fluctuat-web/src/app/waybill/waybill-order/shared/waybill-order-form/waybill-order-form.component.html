<form *ngIf="waybillForm; else loading" [formGroup]="waybillForm">

  <div formGroupName="order">
  <div class="card">
    <div class="card-content" formGroupName="customer">
      <p class="title">Donneur d'ordre</p>

      <flu-form-field>
        <datalist id="flu-customer-name">
          <option *ngFor="let item of contacts?.customerNames" [value]="item">
        </datalist>

        <label class="label">Nom ou raison sociale</label>
        <input class="input is-medium" formControlName="name" list="flu-customer-name">
      </flu-form-field>

      <div class="field">
        <div class="control">
          <datalist id="flu-customer-email">
            <option *ngFor="let item of contacts?.customerEmails" [value]="item">
          </datalist>

          <label class="label">Email de contact</label>
          <input class="input is-medium" formControlName="email" type="email" list="flu-customer-email"
                 [ngClass]="{'is-danger': hasError(waybillForm.get('order.customer').controls.email)}">
        </div>
        <p *ngIf="hasError(waybillForm.get('order.customer').controls.email)" class="help is-danger">
          L'email n'est pas valide</p>
      </div>

    </div>
  </div>

  <div class="level"></div>

  <div class="card">
    <div class="card-content" formGroupName="sender">
      <p class="title">Expéditeur</p>

      <flu-form-field>
        <datalist id="flu-sender-name">
          <option *ngFor="let item of contacts?.senderNames" [value]="item">
        </datalist>
        <label class="label">Nom ou raison sociale</label>
        <input class="input is-medium" formControlName="name" list="flu-sender-name">
      </flu-form-field>

      <div class="field">
        <div class="control">
          <datalist id="flu-sender-email">
            <option *ngFor="let item of contacts?.senderEmails" [value]="item">
          </datalist>
          <label class="label">Email de contact</label>
          <input class="input is-medium" formControlName="email" type="email" list="flu-sender-email"
                 [ngClass]="{'is-danger': hasError(waybillForm.get('order.sender').controls.email)}">
        </div>
        <p *ngIf="hasError(waybillForm.get('order.sender').controls.email)" class="help is-danger">
          L'email n'est pas valide</p>
      </div>

    </div>
  </div>

  <div class="level"></div>

  <div class="card">
    <div class="card-content" formGroupName="receiver">
      <p class="title">Destinataire</p>

      <flu-form-field>
        <datalist id="flu-receiver-names">
          <option *ngFor="let item of contacts?.receiverNames" [value]="item">
        </datalist>
        <label class="label">Nom ou raison sociale</label>
        <input class="input is-medium" formControlName="name" list="flu-receiver-names">
      </flu-form-field>

      <div class="field">
        <div class="control">
          <datalist id="flu-receiver-emails">
            <option *ngFor="let item of contacts?.receiverEmails" [value]="item">
          </datalist>
          <label class="label">Email de contact</label>
          <input class="input is-medium" formControlName="email" type="email" list="flu-receiver-emails"
                 [ngClass]="{'is-danger': hasError(waybillForm.get('order.receiver').controls.email)}">
        </div>
        <p *ngIf="hasError(waybillForm.get('order.receiver').controls.email)" class="help is-danger">
          L'email n'est pas valide</p>
      </div>

    </div>
  </div>

  <div class="level"></div>

  <div class="card">
    <div class="card-content" formGroupName="transporter">
      <p class="title">Transporteur</p>

      <flu-form-field>
        <datalist id="flu-transporter-names">
          <option *ngFor="let item of contacts?.transporterNames" [value]="item">
        </datalist>
        <label class="label">Nom</label>
        <input class="input is-medium" formControlName="name" list="flu-transporter-names">
      </flu-form-field>

      <div class="field">
        <div class="control">
          <datalist id="flu-transporter-emails">
            <option *ngFor="let item of contacts?.transporterEmails" [value]="item">
          </datalist>
          <label class="label">Email de contact</label>
          <input class="input is-medium" formControlName="email" type="email" list="flu-transporter-emails"
                 [ngClass]="{'is-danger': hasError(waybillForm.get('order.transporter').controls.email)}">
        </div>
        <p *ngIf="hasError(waybillForm.get('order.transporter').controls.email)" class="help is-danger">
          L'email n'est pas valide</p>
      </div>

      <div class="field">
        <div class="control">
          <datalist id="flu-transporter-cellphones">
            <option *ngFor="let item of contacts?.transporterCellphones" [value]="item">
          </datalist>
          <label class="label">Téléphone portable</label>
          <input class="input is-medium" formControlName="cellphone" list="flu-transporter-cellphones"
                 [ngClass]="{'is-danger': hasError(waybillForm.get('order.transporter').controls.cellphone)}">
        </div>
      </div>
      <p *ngIf="hasError(waybillForm.get('order.transporter').controls.cellphone)" class="help is-danger">
        Le numéro de portable n'est pas au format 06 01 02 03 04</p>
    </div>
  </div>

  <div class="level"></div>

  <div class="card">
    <div class="card-content" formGroupName="ship">
      <p class="title">Bateau</p>

      <flu-form-field>
        <datalist id="flu-ship-names">
          <option *ngFor="let item of contacts?.shipNames" [value]="item">
        </datalist>
        <label class="label">Devise</label>
        <input class="input is-medium" formControlName="name" list="flu-ship-names">
      </flu-form-field>

      <flu-form-field>
        <datalist id="flu-ship-reg-numbers">
          <option *ngFor="let item of contacts?.shipRegNumbers" [value]="item">
        </datalist>
        <label class="label">Matricule</label>
        <input class="input is-medium" formControlName="regNumber" list="flu-ship-reg-numbers">
      </flu-form-field>

    </div>
  </div>
  </div>

  <div class="level"></div>

  <div class="card">
    <div class="card-content">
      <p class="title">Informations sur le voyage et la marchandise</p>

      <ng-container formGroupName="loadInfo">
        <datalist id="ports">
          <option *ngFor="let port of ports" [value]="port">
        </datalist>

        <flu-form-field>
          <label class="label">Lieu départ</label>
          <input class="input is-medium" formControlName="origin" list="ports">
        </flu-form-field>

        <flu-form-field>
          <label class="label">Lieu d'arrivée</label>
          <input class="input is-medium" formControlName="destination" list="ports">
        </flu-form-field>

        <div class="field">
          <div class="control">
            <label class="label">Date d'arrivée prévue</label>
            <input class="input is-medium" formControlName="arrivalDate" fluDatetimePicker
                   [(date)]="waybillForm.value.loadInfo.arrivalDate">
          </div>
        </div>

        <flu-form-field>
          <label class="label">Nature de la marchandise</label>
          <input class="input is-medium" formControlName="merchandiseType">
        </flu-form-field>

        <div class="field">
          <div class="control">
            <label class="label">Valeur déclarée de la marchandise (euros par tonne)</label>
            <input class="input is-medium" formControlName="merchandisePrice"
                   [ngClass]="{'is-danger': hasError(waybillForm.get('loadInfo').controls.merchandisePrice)}">
          </div>
          <p *ngIf="hasError(waybillForm.get('loadInfo').controls.merchandisePrice)" class="help is-danger">
            La valeur saisie n'est pas un nombre valide
          </p>
        </div>

        <div class="field" formGroupName="loadManager">
          <div class="control">

            <label class="label">Email de contact du lieu de chargement</label>
            <input class="input is-medium" formControlName="email" type="email"
                   [ngClass]="{'is-danger': hasError(waybillForm.get('loadInfo.loadManager').controls.email)}">
          </div>
          <p *ngIf="hasError(waybillForm.get('loadInfo.loadManager').controls.email)" class="help is-danger">
            L'email n'est pas valide</p>
        </div>
      </ng-container>

      <ng-container formGroupName="unloadInfo">
        <div class="field" formGroupName="loadManager">
          <div class="control">

            <label class="label">Email de contact du lieu de déchargement</label>
            <input class="input is-medium" formControlName="email" type="email"
                   [ngClass]="{'is-danger': hasError(waybillForm.get('unloadInfo.loadManager').controls.email)}">
          </div>
          <p *ngIf="hasError(waybillForm.get('unloadInfo.loadManager').controls.email)" class="help is-danger">
            L'email n'est pas valide</p>
        </div>
      </ng-container>

    </div>
  </div>

</form>

<ng-template #loading>
  <flu-loading></flu-loading>
</ng-template>
